<!-- Camillo Malnati, Riccardo Gabriele -->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">


<dom-module id="image-component">
  <template>

  <style>

  p{
    position: absolute !important;
    clip: rect(1px, 1px, 1px, 1px);
  }


  </style>

  <p aria-live="polite" tabindex="0" id="image-text">{{text}}</p>

  </template>

  <script>
  (function () {
    'use strict';

    Polymer({
      is: 'image-component',

      _hearDescription: function(e) {
        console.log(e)
        let a = this.shadowRoot.getElementById("image-text")
        if (e.key == "1" && this.normal !== undefined)
        {
            a.innerHTML = this.normal;
            this.shadowRoot.getElementById("image-text");
        }
        if (e.key == "2" && this.simplified !== undefined)
        {
          a.innerHTML = this.simplified;
          this.shadowRoot.getElementById("image-text");
        }
        if (e.key == "3" && this.emotional !== undefined)
        a.innerHTML = this.emotional;
        this.shadowRoot.getElementById("image-text");
      },
      ready: function() {
        console.log(this.tags)

        function htmlToElement(html) {
            var template = document.createElement('template');
            template.innerHTML = html;
            return template.content.firstChild;
        }

        let a = this.shadowRoot.getElementById("image-text")

        if (this.text === undefined)
        {
          a.innerHTML = "You are on an image";
          if (normal !== undefined)
          {
            a.innerHTML += ", to hear the full description, press 1"
          }
          if (simplified !== undefined)
          {
            a.innerHTML += ", to hear the concise description, press 2"
          }
          if (emotional !== undefined)
          {
            a.innerHTML += ", to hear the emotional description, press 3"
          }
          a.innerHTML += "."

        }

        let image = htmlToElement("<img " + this.tags + ">")
        this.shadowRoot.appendChild(image);
        this.addEventListener("keydown", this._hearDescription, true);
      },
      properties: {
          tags:{
            type: String,
            default: false
          },
          text:{
            type: String,
            default: undefined
          },
          normal:{
            type: String,
            default: undefined
          },
          simplified:{
            type: String,
            default: undefined
          },
          emotional:{
            type: String,
            default: undefined
          },
        },
    });
})();
  </script>

</dom-module>
