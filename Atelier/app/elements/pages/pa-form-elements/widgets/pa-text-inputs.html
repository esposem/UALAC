<link rel="import" href="../../pa-typo/widgets/pa-typo-content.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-input/paper-textarea.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/styles/shared-styles.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<dom-module id="pa-text-inputs" is="dom-bind">
  <template>
    <style include="shared-styles"></style>
    <style>
      paper-button {
        display: block;
        margin-bottom: 0px;
        border: 1px red;
      }

      paper-button[toggles] {
        transition: background-color 0.3s;
      }

      paper-button[toggles][active] {
        background-color: lightcoral;
      }

      paper-button[toggles][active].colorful {
        background-color: rgba(66, 133, 244, 0.25);
      }

      paper-button[toggles][active][raised].colorful {
        background-color: rgba(66, 133, 244, 0.75);
      }

      paper-button.blue {
        --paper-button-flat-focus-color: var(--paper-light-blue-50);
        color: var(--paper-light-blue-500);
      }
      paper-button.blue:hover {
        background: var(--paper-light-blue-50);
      }
      paper-button.red {
        --paper-button-flat-focus-color: var(--paper-red-50);
        color: var(--paper-red-500);
      }
      paper-button.red:hover {
        background: var(--paper-red-50);
      }
      paper-button.orange {
        --paper-button-flat-focus-color: var(--paper-orange-50);
        color: var(--paper-orange-500);
      }
      paper-button.orange:hover {
        background: var(--paper-orange-50);
      }

      paper-button.hover:hover {
        background: #eee;
      }

      paper-button.ripple {
        --paper-button-ink-color: var(--paper-pink-a200);
      }

      pa-simple-grid{
        margin-left: -15px;
        margin-right: -15px;
        box-sizing: border-box;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }

      paper-material{
        min-width: 95%;
        max-width: 95%;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }

      paper-textarea{
        min-height: 70px;
        max-height: 300px;
        overflow-y: scroll;
        margin-top: 50px;
      }

      .fit{
        left:5px;
      }

      #title-field-title {
        align-self: center;
        padding-top: 16px;
        padding-bottom:0px;
        padding-right: 15px;"
      }

      #title {
        flex-grow: 0;
        align-self: center;
        padding:0px;
        width:40%;
      }

      #title-id {
        align-self: center;
        padding-top: 16px;
        padding-bottom:0px;
        padding-right: 15px;
        padding-left: 15px;
      }

      #articleid {
        align-self: center;
        padding-top: 16px;
        width:40%;
      }

    </style>
    <pa-simple-grid sm-cols="1">
      <paper-material class="widget" elevation="1">

        <div class="vertical-section">

          <div style="display: flex; flex-direction: row">

            <div id="title-field-title" class="paper-font-title">
                Title </div>

            <paper-input id="title" required auto-validate error-message="needs some text!" label="Article title"></paper-input>

            <div id="title-id" class="paper-font-title">
                  ID
              </div>

            <div id="articleid">
              <i style="font-weight: bold;">No id yet</i>
            </div>

            <paper-button tabindex="0" id="submitbutton" on-click="deleteverything"  raised noink
                style= "width:20%; text-align: center; margin-top: 20px;">New Article</paper-button>

          </div>

        </div>
        <paper-toast id="toast">
        </paper-toast>

          </div>

          <br></br>
          <div style="display:flex; flex-direction: column;">
            <paper-button tabindex="0" id="htmlbutton" toggles raised noink on-click="ishtml"
              style= "width:0%; text-align: center;">HTML</paper-button>
            <paper-textarea  id="inputbox"  label="Write the article here" on-input="clicked"></paper-textarea>
            <div style="display:flex; flex-direction: row-reverse;">
              <iron-ajax
              id="ajax"
              url="/dashboard"
              handle-as="json"
              content-type ="application/json"
              on-response="finished">
            </iron-ajax>
              <paper-button tabindex="0" id="submitbutton" on-click="ajaxrequest"  raised noink
                  style= "width:0%; text-align: center; margin-top: 20px;">Submit</paper-button>
            </div>
          </div>
        </div>
      </paper-material>
    </pa-simple-grid>

    <br>
    <br>
    <pa-simple-grid sm-cols="1" >
      <paper-material class="widget" elevation="1">
      <h4>
        Result
      </h4>

      <div id= "demo" style="word-wrap: break-word;">
        <div>
        Nothing to show
        </div>
      </div>
    </paper-material>
  </pa-simple-grid>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'pa-text-inputs',
        properties : {
          html_clicked : {
            type : Boolean,
            value : false,
          },
          wrotebefore : {
            type : String,
          },
        },

        ishtml: function() {
              this.html_clicked = !(this.html_clicked);
              // console.log(this.html_clicked);
              if(this.html_clicked){
                // this.wrotebefore = this.$.inputbox.value;
                this.$.inputbox.value = this.$.demo.innerHTML
              }else{
                // if(this.wrotebefore) {
                //   this.$.inputbox.value = this.wrotebefore;
                // }else{
                  this.$.inputbox.value = this.$.demo.childNodes[1].innerHTML;
                // }
              }
        },

        clicked: function() {
          // console.log(this.$.inputbox);
          let x = this.$.inputbox.value;
          let text = x || "Nothing to show";
          if(!this.html_clicked){
            text = text.split("\n").join("<br>");
          }
          // console.log(this.$.demo.childNodes[1]);
          this.$.demo.childNodes[1].innerHTML =  text;
          this.wrotebefore = text;
          // this.$.inputbox.value = "a" + this.$.inputbox.value;
        },

        deleteverything: function(){
          this.$.articleid.childNodes[1].innerHTML = "No id yet"
          this.$.inputbox.value = ""
          this.$.title.value=" "
          this.$.title.value=""
          this.$["title-field-title"].style="";
          // console.log(this.$.title);
        },

        ajaxrequest : function(){
          let ajaxel = this.$.ajax;
          let txt = this.$.inputbox.value;
          let tle = this.$.title.value;
          // console.log(this.$.articleid.childNodes[1].innerHTML);
          if(tle){
            // console.log("title valid");
            let id = this.$.articleid.childNodes[1].innerHTML;
            if(id !== "No id yet"){
              // console.log("Put Request");
              ajaxel.method="PUT"
              ajaxel.body = JSON.stringify({"_id" : id, "text": txt, "title" : tle});
            }else{
              // console.log("Post Request");
              ajaxel.method="POST"
              ajaxel.body = JSON.stringify({"text": txt, "title" : tle});
            }
            ajaxel.generateRequest();

          }else{
              // console.log("title is not valid! no request made");
              this.$.title.value = " "; // Done to show the error in the paper-input
              this.$.title.value = "";
              this.$["title-field-title"].style="color: red;";
          }

        },

        finished : function(el){
          let id = this.$.articleid.childNodes[1].innerHTML;
          if(id === "No id yet"){
            this.$.articleid.childNodes[1].innerHTML = el.detail.response;
            this.$.toast.text = 'Created a new Article!';
            this.$.toast.show();
          }else{
            this.$.toast.text = 'Article ' + id + " updated!";
            this.$.toast.show();
          }


        },


      });
    })();
  </script>

</dom-module>
